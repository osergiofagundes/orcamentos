generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== TABELAS DE AUTENTICAÇÃO ====================
model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean
  image         String?
  createdAt     DateTime
  updatedAt     DateTime
  sessions      Session[]
  accounts      Account[]
  orcamentos    Orcamento[] // Relação adicionada
  usuariosAreas UsuarioAreaTrabalho[] // Relação adicionada

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime

  @@map("account")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

// ==================== TABELAS DE ORÇAMENTOS ====================
enum StatusOrcamento {
  RASCUNHO
  ENVIADO
  APROVADO
  REJEITADO
  CANCELADO
}

enum TipoProdutoServico {
  PRODUTO
  SERVICO
}

enum TipoValor {
  UNIDADE
  METRO
  PESO
  HORA
  DIA
}

model AreaTrabalho {
  id                  Int            @id @default(autoincrement())
  nome                String         @db.VarChar(255)
  descricao           String?
  cpf_cnpj            String?
  endereco            String?
  bairro              String?
  cidade              String?
  estado              String?
  cep                 String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  deletedAt           DateTime?
  usuariosAreas       UsuarioAreaTrabalho[]
  clientes            Cliente[]
  produtosServicos    ProdutoServico[]
  categorias          Categoria[]
  orcamentos         Orcamento[]

  @@map("area_trabalho")
}

model UsuarioAreaTrabalho {
  id                  Int            @id @default(autoincrement())
  usuario_id          String         // Alterado para String para relacionar com User.id
  area_trabalho_id    Int
  nivel_permissao     Int
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  usuario             User           @relation(fields: [usuario_id], references: [id], onDelete: Cascade)
  areaTrabalho        AreaTrabalho   @relation(fields: [area_trabalho_id], references: [id], onDelete: Cascade)

  @@unique([usuario_id, area_trabalho_id])
  @@map("usuario_area_trabalho")
}

model Cliente {
  id                  Int            @id @default(autoincrement())
  nome                String         @db.VarChar(255)
  cpf_cnpj            String         @db.VarChar(255)
  telefone            String         @db.VarChar(255)
  email               String         @db.Text
  endereco            String         @db.Text
  area_trabalho_id    Int
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  deletedAt           DateTime?
  areaTrabalho        AreaTrabalho   @relation(fields: [area_trabalho_id], references: [id])
  orcamentos         Orcamento[]

  @@unique([cpf_cnpj, area_trabalho_id])
  @@map("cliente")
}

model Orcamento {
  id                  Int            @id @default(autoincrement())
  data_criacao        DateTime       @default(now())
  valor_total         Int?           // Em centavos (R$ 10,50 = 1050)
  status              StatusOrcamento @default(RASCUNHO)
  observacoes         String?        @db.Text
  cliente_id          Int
  usuario_id          String         // Alterado para String para relacionar com User.id
  area_trabalho_id    Int
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  deletedAt           DateTime?
  cliente             Cliente        @relation(fields: [cliente_id], references: [id])
  usuario             User           @relation(fields: [usuario_id], references: [id])
  areaTrabalho        AreaTrabalho   @relation(fields: [area_trabalho_id], references: [id])
  itensOrcamento     ItemOrcamento[]

  @@map("orcamento")
}

model ItemOrcamento {
  id                  Int            @id @default(autoincrement())
  orcamento_id        Int
  produto_servico_id  Int
  quantidade          Int
  preco_unitario      Int            // Em centavos (R$ 10,50 = 1050)
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  orcamento           Orcamento      @relation(fields: [orcamento_id], references: [id])
  produtoServico      ProdutoServico @relation(fields: [produto_servico_id], references: [id])

  @@map("item_orcamento")
}

model ProdutoServico {
  id                  Int            @id @default(autoincrement())
  nome                String         @db.VarChar(255)
  descricao           String?        @db.Text
  valor               Int?           // Em centavos (R$ 10,50 = 1050)
  tipo                TipoProdutoServico @default(PRODUTO)
  tipo_valor          TipoValor      @default(UNIDADE)
  categoria_id        Int
  area_trabalho_id    Int
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  deletedAt           DateTime?
  categoria           Categoria      @relation(fields: [categoria_id], references: [id])
  areaTrabalho        AreaTrabalho   @relation(fields: [area_trabalho_id], references: [id])
  itensOrcamento     ItemOrcamento[]

  @@map("produto_servico")
}

model Categoria {
  id                  Int            @id @default(autoincrement())
  nome                String         @db.VarChar(255)
  descricao           String?        @db.Text
  area_trabalho_id    Int
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  deletedAt           DateTime?
  areaTrabalho        AreaTrabalho   @relation(fields: [area_trabalho_id], references: [id])
  produtosServicos    ProdutoServico[]

  @@map("categoria")
}